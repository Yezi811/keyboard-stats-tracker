# 图标显示问题解决方案

## 问题描述
主窗口左上角和任务栏的图标没有显示为 `build/tray-icon.ico` 的自定义图标。

## 根本原因
这是 **Windows 图标缓存**的问题，不是应用程序的问题。

- ✅ EXE 文件已经正确嵌入了你的自定义图标
- ✅ `package.json` 配置正确（`win.icon: "build/tray-icon.ico"`）
- ❌ Windows 缓存了旧图标，即使 EXE 更新了也显示旧图标

## 解决方案

### 方法 1：运行清除缓存脚本（推荐）

1. 双击运行 `clear-icon-cache.bat`
2. 脚本会自动：
   - 关闭 Windows 资源管理器
   - 删除图标缓存文件
   - 重启资源管理器
3. 重新打开应用，图标应该正确显示

### 方法 2：手动清除缓存

打开 PowerShell（管理员权限）运行：

```powershell
# 关闭资源管理器
taskkill /f /im explorer.exe

# 删除图标缓存
del /a /q "$env:LOCALAPPDATA\IconCache.db"
del /a /f /q "$env:LOCALAPPDATA\Microsoft\Windows\Explorer\iconcache*"

# 重启资源管理器
start explorer.exe
```

### 方法 3：重启电脑

最简单但最慢的方法：重启电脑后图标缓存会自动清除。

### 方法 4：复制到新位置测试

将 EXE 文件复制到一个新的文件夹，Windows 会为新位置的文件生成新的图标缓存。

## 验证图标是否正确嵌入

如果清除缓存后图标仍然不对，可以验证 EXE 文件是否正确嵌入了图标：

### 使用 Resource Hacker（推荐）

1. 下载 Resource Hacker：http://www.angusj.com/resourcehacker/
2. 打开 `Keyboard Stats Tracker.exe`
3. 展开左侧的 "Icon Group"
4. 查看是否包含你的自定义图标的所有尺寸

### 使用 PowerShell 查看

```powershell
# 查看 EXE 文件的图标资源
[System.Drawing.Icon]::ExtractAssociatedIcon("path\to\Keyboard Stats Tracker.exe")
```

## 当前配置状态

✅ **已正确配置：**
- `package.json` 中 `win.icon` 设置为 `build/tray-icon.ico`
- ICO 文件大小：192KB（包含多尺寸）
- ICO 文件位置：`build/tray-icon.ico`
- 已移除运行时的图标设置（让 Windows 使用 EXE 嵌入的图标）

## 常见误区

❌ **错误认识：** 修改 ICO 文件后重新打包，图标就会立即更新
✅ **正确认识：** Windows 会缓存图标，必须清除缓存才能看到新图标

❌ **错误认识：** 在代码中设置 `icon` 参数可以改变窗口图标
✅ **正确认识：** 窗口和任务栏图标来自 EXE 文件嵌入的图标，不是运行时设置的

## 最终确认

清除缓存后，你应该看到：
- ✅ 窗口左上角显示自定义图标
- ✅ 任务栏显示自定义图标
- ✅ 系统托盘显示自定义图标（来自 `assets/tray-icon.png`）
- ✅ Windows 资源管理器中的 EXE 文件显示自定义图标

如果清除缓存后仍然不对，请使用 Resource Hacker 验证图标是否正确嵌入到 EXE 文件中。
